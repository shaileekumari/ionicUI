<ion-header>
  <ion-toolbar color='primary'>
    <ion-title>Insurance App</ion-title>
    <ion-buttons slot='end'>

        <!-- <mat-menu #notifyMenu="matMenu">
            <button mat-menu-item>Notification {{user_details.firstName}}!</button>
           
          </mat-menu>
          
          <button mat-icon-button [matMenuTriggerFor]="notifyMenu" style="margin-right:1.2rem">
            <mat-icon matBadge="4" matBadgeOverlap="false">notifications</mat-icon>
          </button> -->


        <mat-menu #appMenu="matMenu">
            <button mat-menu-item>Welcome {{user_details.firstName}}!</button>
            <button mat-menu-item (click)='logout()'>Logout</button>
          </mat-menu>
          
          <button mat-icon-button [matMenuTriggerFor]="appMenu">
            <mat-icon>account_circle</mat-icon>
          </button>

    </ion-buttons>
    
  </ion-toolbar>
</ion-header>
<ion-content>
  <div>

      <mat-tab-group (selectedTabChange)="seletedTabClick($event)">
          <mat-tab label="Dashboard">
            
            <div *ngIf="!display">

               
                <ion-toolbar>
                    <ion-title>Insurance Claims</ion-title>
                  </ion-toolbar>

                  
                  <ion-card *ngFor="let policy of policy_details" (click)='openCard(policy)'>
                      <ion-card-header>
                
                              <ion-row>
                                <ion-col size-md="6"> <ion-card-subtitle color='dark' >Policy Id: {{policy.Key}}</ion-card-subtitle></ion-col>
                                <ion-col size-md="6"  text-right> <ion-card-subtitle color='dark' >Status: {{policy.Record['policy_status']}}</ion-card-subtitle></ion-col>
                                </ion-row>
                
                
                         
                         
                          
                      </ion-card-header>
                    
                    <ion-card-content>
                      
                            <ion-row>
                              <ion-col size-md="7">Start date: {{policy.Record.start_date}}</ion-col>
                              <ion-col size-md="5" text-right>End date: {{policy.Record.expiry_date}}</ion-col>
                
                              </ion-row>
                             
                
                               
                      
                        </ion-card-content>
                  </ion-card>
            </div>

            <div *ngIf="display">
                <ion-item>
                   <ion-toolbar align='center'>
                       <ion-title>Crop Insurance Details</ion-title>
                       <ion-buttons slot='primary'>
                         
                         <ion-button color='primary' (click)='display=false;'>Back</ion-button>
                       </ion-buttons>
                     </ion-toolbar>  
                </ion-item>   
                  
               <ion-card>
                 <div align='center' style="margin: 5px;
                 font-size: 21px;
                 font-weight: 500;
                 border-bottom: 2px solid #d6d3d3;
                 background: linear-gradient(#2c75a0a3, #e2e2def5);">
                     <ion-label class='fontHeader'>Policy Details</ion-label>
                   </div>
                 <ion-row>
                   <ion-col size-md="4" size-xs="12" >
                       <ion-item>
                           <ion-label class='font' position="stacked">Policy Id</ion-label>
                           <ion-input readOnly>{{each_policy.policy_id}}</ion-input>
                         </ion-item>
                   </ion-col>
               
                   <ion-col size-md="4" size-xs="12" >
                       <ion-item>
                           <ion-label class='font' position="stacked">Status</ion-label>
                           <ion-input readOnly>{{each_policy.policy_status}}</ion-input>
                         </ion-item>
                   </ion-col>
                   <ion-col size-md="4" size-xs="12">
                       <ion-item>
                           <ion-label class='font' position="stacked">Insured Amount</ion-label>
                           <ion-input readOnly>{{each_policy.amount_insured}}</ion-input>
                         </ion-item>
                   </ion-col>
                   <ion-col size-md="4" size-xs="12">
                       <ion-item>
                           <ion-label class='font' position="stacked">Start Date</ion-label>
                           <ion-input readOnly>{{each_policy.start_date}}</ion-input>
                         </ion-item>
                   </ion-col>
                   <ion-col size-md="4" size-xs="12">
                       <ion-item>
                           <ion-label class='font' position="stacked">End Date</ion-label>
                           <ion-input readOnly>{{each_policy.expiry_date}}</ion-input>
                         </ion-item>
                   </ion-col>
                   
               
                 </ion-row>
                 
               
               </ion-card> 
               <ion-card>
                 <div align='center' style="margin: 5px;
                 font-size: 21px;
                 font-weight: 500;
                 border-bottom: 2px solid #d6d3d3;
                 background: linear-gradient(#2c75a0a3, #e2e2def5);">
                     <ion-label class='fontHeader'>Farm Details</ion-label>
                   </div>
                   <ion-row>
                       <ion-col size-md="4" size-xs="12">
                           <ion-item>
                               <ion-label class='font' position="stacked">Farmer Id</ion-label>
                               <ion-input readOnly>{{each_policy.farmer_id}}</ion-input>
                             </ion-item>
                       </ion-col>
                       <ion-col size-md="4" size-xs="12">
                               <ion-item>
                                   <ion-label class='font' position="stacked">Farm Id</ion-label>
                                   <ion-input readOnly>{{each_policy.farm_id}}</ion-input>
                                 </ion-item>
                           </ion-col>
                           <ion-col size-md="4" size-xs="12">
                                   <ion-item>
                                       <ion-label class='font' position="stacked">Insurer Id</ion-label>
                                       <ion-input readOnly>{{each_policy.insurer_id}}</ion-input>
                                     </ion-item>
                               </ion-col>
                               <ion-col size-md="4" size-xs="12">
                               <div *ngFor='let claim of each_policy.claim'>
               
                                       <ion-col size-md="4" size-xs="12" >
                                               <ion-item>
                                                   <ion-label class='font' position="stacked">Claim Id</ion-label>
                                                   <ion-input readOnly>{{claim.claimId}}</ion-input>
                                               </ion-item>
                                           </ion-col>
                               <ion-col size-md="4" size-xs="12" >
                                   <ion-item>
                                       <ion-label class='font' position="stacked">Claim Status</ion-label>
                                       <ion-input readOnly>{{claim.claimStatus}}</ion-input>
                                   </ion-item>
                               </ion-col>
                               <ion-col size-md="4" size-xs="12" >
                                       <ion-item>
                                           <ion-label class='font' position="stacked">Claim Amount</ion-label>
                                           <ion-input readOnly>{{claim.claimedAmount}}</ion-input>
                                       </ion-item>
                                   </ion-col>
               
                                   <ion-col size-md="4" size-xs="12" >
                                           <ion-item>
                                               <ion-label class='font' position="stacked">Created On</ion-label>
                                               <ion-input readOnly>{{claim.createdOn}}</ion-input>
                                           </ion-item>
                                       </ion-col>
               
                                       <ion-col size-md="4" size-xs="12" >
                                               <ion-item>
                                                   <ion-label class='font' position="stacked">Processed On</ion-label>
                                                   <ion-input readOnly>{{claim.processedOn}}</ion-input>
                                               </ion-item>
                                           </ion-col>

                                          
                               </div>

                               <ion-col size-md="6" size-xs="12" >
                                      <div *ngIf="each_policy.policy_status=='New'" align='center'>
                                          <ion-button size="large"   (click)="updatePolicy(each_policy.policy_id,'Active')">Activate Policy</ion-button>
                                    
                                      </div>
                                
                                          
                                            
                                     
                                 
                              </ion-col>
                               </ion-col>
             
               
                     
                   </ion-row>
                   
                 
                 </ion-card> 
               </div>
          </mat-tab>




          <mat-tab label="Profile">

              <mat-menu #profileMenu="matMenu">
                  
                  <button mat-menu-item (click)='saveUserBlockainData()'>Register to Blockchain</button>
                  <button mat-menu-item (click)='editProfile=true'>Update Profile</button>
                  <button mat-menu-item (click)="fetchUserDataByUserID()">Display Blockchain Profile</button>
                  
                </mat-menu>
                
                <button mat-icon-button [matMenuTriggerFor]="profileMenu">
                  <mat-icon>list</mat-icon>
                </button>
              <div *ngIf='!editProfile'>
                  <ion-card>
                      <ion-grid>
                          <ion-row color="primary" class="ion-justify-content-center">
                            <ion-col class="ion-align-self-center border" size-md="6" size-lg="5" size-xs="12">
                              <br>
                              <div style="padding: 3px;">
                              <div align='center' style="margin: 5px;
                          font-size: 21px;
                          font-weight: 500;
                          border-bottom: 2px solid #d6d3d3;
                          background: linear-gradient(#2c75a0a3, #e2e2def5);">
                              <ion-label class='font'>User Details</ion-label>
                            </div>  
                                  <ion-item>
                                      <ion-label class='font' position="floating">Username</ion-label>
                                      <ion-input value="{{userData.fullName}}" readonly align='end'></ion-input>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label class='font' position="stacked">User Id</ion-label>
                                        <ion-input value="{{userData.id}}" readonly align='end'></ion-input>
                                      </ion-item>
                                    <ion-item>
                                      <ion-label class='font' position="stacked">Role</ion-label>
                                      <ion-input value="{{userData.role}}" readonly align='end'></ion-input>
                                    </ion-item>
                                    <ion-item>
                                      <ion-label class='font' position="stacked">Phone No.</ion-label>
                                      <ion-input value="{{userData.phoneNo}}" readonly align='end'></ion-input>
                                    </ion-item>
                                    <ion-item>
                                        <ion-label class='font' position="stacked">Email</ion-label>
                                        <ion-input value="{{userData.email}}" readonly align='end'></ion-input>
                                      </ion-item>
                                      <div *ngIf="showUpdate">
                                          <ion-item>
                                              <ion-label class='font' position="stacked">Address</ion-label>
                                              <ion-input value="{{showUser.homeAddress}}" readonly align='end'></ion-input>
                                            </ion-item>

                                            <div *ngFor='let eachAccount of showUser.accountDetails'>
                                                <ion-item>
                                                    <ion-label class='font' position="stacked">Bank Name</ion-label>
                                                    <ion-input value="{{eachAccount.bankName}}" readonly align='end'></ion-input>
                                                  </ion-item>
                                              <ion-item>
                                                  <ion-label class='font' position="stacked">Account Number</ion-label>
                                                  <ion-input value="{{eachAccount.accountNumber}}" readonly align='end'></ion-input>
                                                </ion-item>
                                                <ion-item>
                                                    <ion-label class='font' position="stacked">Account Balance</ion-label>
                                                    <ion-input value="{{eachAccount.balance}}" readonly align='end'></ion-input>
                                                  </ion-item>
                          
                                          
                                             
                                             <br>
                          
                          
                                        </div>
                                      </div>
                                   <br>
                                   
                                   
                                  
                                   
                              </div>
      
                
                
                    
                  
                  </ion-col>
                  </ion-row>
                  </ion-grid>
                  </ion-card>
                </div>


                <div *ngIf="editProfile">
                    <ion-card>
                        <ion-grid>
                            <ion-row color="primary" class="ion-justify-content-center">
                              <ion-col class="ion-align-self-center border" size-md="6" size-lg="5" size-xs="12">
                                <br>
                         
                        <form #form="ngForm" (ngSubmit)="update(form)">
                            
                              
                              <ion-item>
                             
                                  <ion-label class='font' position="stacked">Address</ion-label>
                                   <ion-input name="homeAddress" type="text"  ngModel required></ion-input>
                                 </ion-item>
                         
                          
              
                        
                      
                           
              
                              
                               <br>
              
                             
                               <br>
              
                              
              
                               <ion-item>
                                  <ion-label class='font' position="stacked">Bank Name</ion-label>
                                  <ion-input name="bankName" type="text" ngModel required></ion-input>
                               
                                
                              </ion-item>
                              <ion-item>
                                
                                  <ion-label class='font' position="stacked">Account Number</ion-label>
                                  <ion-input name="accountNo" type="number"  ngModel required></ion-input>
                                 
                                  
                                </ion-item>
              
                      
                            
                         
                      
                          <div>
                            <ion-toolbar>
                                <ion-buttons slot="primary">
                                    <ion-button size="large" type="submit" [disabled]="form.invalid">Update</ion-button>
                         
                                    <ion-button (click)="editProfile=false">Close</ion-button>
                                  </ion-buttons>
                            </ion-toolbar>
                             
                              
                          </div>
                          
                      
                      </form>
                     
                      
              
                  </ion-col>
                  </ion-row>
                  </ion-grid>
                  
                    </ion-card>
                     
                  </div>


           
          </mat-tab>
        </mat-tab-group>
  </div>
      
 
    
</ion-content>